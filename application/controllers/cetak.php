<?php class Cetak extends CI_Controller {var $phpdocx;var $template;var $report;/*** Attribute ***/	public function __construct() {		parent::__construct();		$this->phpdocx = realpath(APPPATH . '../assets/phpdocx-pro-4.1/classes/');		$this->template = realpath(APPPATH . '../assets/phpdocx-pro-4.1/templates/');		$this->report = realpath(APPPATH . '../assets/files/report/');		$this->load->database();		$this->load->model('Prodi_model');		$this->load->model('Matkul_model');		$this->load->model('Prodi_model');		$this->load->model('Unit_model');		$this->load->model('Jadwal_model');		$this->load->model('Penelitian_model');		$this->load->model('Pm_model');		$this->load->model('Publikasi_model');		$this->load->model('Dosen_model');		$this->load->model('Kurikulum_model');		error_reporting(E_ALL ^ (E_WARNING));	}		private function checkFolder(){		if(is_dir($this->report)){					}else{			mkdir($this->report, 0777);		}	}		private function checkFileReport($reportFileName){		if(file_exists($this->report.$reportFileName)){			return 0;		}else{			return 1;		}	}		private function forceDownloadFile($pathFile){		$pathFile = $pathFile.'.docx';		if(file_exists($pathFile)){			header('Content-Description: File Transfer');			header('Content-Type: application/octet-stream');			header('Content-Disposition: attachment; filename='.basename($pathFile));			header('Content-Transfer-Encoding: binary');			header('Expires: 0');			header('Cache-Control: must-revalidate');			header('Pragma: public');			header('Content-Length: ' . filesize($pathFile));			ob_clean();			flush();			readfile($pathFile);			unlink($pathFile);			exit;		}else{			die('unable to find the file : '.$pathFile);		}	}	public function test(){		require_once($this->phpdocx.'/CreateDocx.inc');		$docx = new CreateDocx();		$docx->addText('Hello world!');		$docx->createDocx('hello_world');	}	/*** Navigation ***/	public function skpengisian($kode_dosen) {					require_once($this->phpdocx.'/CreateDocx.inc');			$docx = new CreateDocxFromTemplate($this->template.'/skpengisian.docx');			$dosen = $this->Dosen_model->dosenWithKode($kode_dosen);			$prodi = $this->Prodi_model->prodiById($dosen->id_prodi);						$docx->replaceVariableByText(array('nama' => $dosen->nama));			$docx->replaceVariableByText(array('nip' => $dosen->nip));			$docx->replaceVariableByText(array('prodi' => $prodi));			$i = 0;			/*PM - begin*/			$listpm = $this->Pm_model->pmByDosen($kode_dosen);			foreach($listpm as $pm) {				$i = $i + 1;				if ($pm->kode_mengabdi_sebagai == 1) {					$status = "Ketua";				} else {					$status = "Anggota";				}						        $tableItems[] = array(		            'no'  => $i, 		            'jenis'  => "Pengabdian Masyarakat",		            'judul'  => $pm->judul,		            'status'  => $status		        );			}			/*Penelitian - end*/			/*Penelitian - begin*/			$listpenelitian = $this->Penelitian_model->penelitianByDosen($kode_dosen);			foreach($listpenelitian as $penelitian) {				$i = $i + 1;				if ($penelitian->kode_meneliti_sebagai == 1) {					$status = "Ketua";				} else {					$status = "Anggota";				}						        $tableItems[] = array(		            'no'  => $i, 		            'jenis'  => "Penelitian",		            'judul'  => $penelitian->judul,		            'status'  => $status		        );			}			/*Penelitian - end*/			/*Publikasi - begin*/			$listpublikasi = $this->Publikasi_model->publikasiByDosen($kode_dosen);			foreach($listpublikasi as $publikasi) {				$i = $i + 1;				if ($publikasi->kode_penulis_sebagai == 1) {					$status = "Penulis Pertama";				} else {					$status = "Penulis Pendamping";				}						        $tableItems[] = array(		            'no'  => $i, 		            'jenis'  => "Publikasi",		            'judul'  => $publikasi->judul,		            'status'  => $status		        );			}			/*Penelitian - end*/			/* echo($prodi);*/			if (count($tableItems) > 0) {				$docx->replaceTableVariable($tableItems);			} else {				$docx->replaceVariableByText(array('no' => ""));				$docx->replaceVariableByText(array('jenis' => ""));				$docx->replaceVariableByText(array('judul' => ""));				$docx->replaceVariableByText(array('status' => ""));			}			$reports = 'Riwayat Pengisian SIKF - '.$dosen->nama;			$docx->clearBlocks();			$docx->createDocx($this->report.'/'.$reports);			$this->forceDownloadFile($this->report.'/'.$reports);			$docx->createDocxAndDownload($reports);			}	public function borang() {		date_default_timezone_set('Asia/Jakarta');require_once($this->phpdocx.'/CreateDocx.inc');		$docx = new CreateDocxFromTemplate($this->template.'/borang.docx');		if(isset($_POST['id_prodi']))			$id_prodi = $_POST['id_prodi'];		else			$id_prodi = 0;		if(isset($_POST['masa']))			$ts = $_POST['masa'];		else			$ts = 2015;		/* $ts = $masa;*/		$tsmin1 = $ts - 1;		$tsmin2 = $ts - 2;		/*IDENTITAS PRODI - BEGIN*/		$dataProdi = $this->Prodi_model->prodiAllById($id_prodi);		$docx->replaceVariableByText(array('prodi' => $dataProdi->prodi));		$docx->replaceVariableByText(array('sk_pendirian' => $dataProdi->sk_pendirian));		$docx->replaceVariableByText(array('tanggal_sk_pendirian' => $dataProdi->tanggal_sk_pendirian));		$docx->replaceVariableByText(array('penandatangan_sk_pendirian' => $dataProdi->penandatangan_sk_pendirian));		$docx->replaceVariableByText(array('waktu_mulai_penyelenggaraan' => $dataProdi->waktu_mulai_penyelenggaraan));		$docx->replaceVariableByText(array('sk_operasional' => $dataProdi->sk_operasional));		$docx->replaceVariableByText(array('tanggal_sk_operasional' => $dataProdi->tanggal_sk_operasional));		$docx->replaceVariableByText(array('peringkat_akreditasi' => $dataProdi->peringkat_akreditasi));		$docx->replaceVariableByText(array('sk_banpt' => $dataProdi->sk_banpt));		$docx->replaceVariableByText(array('alamat' => $dataProdi->alamat));		$docx->replaceVariableByText(array('telp' => $dataProdi->telp));		$docx->replaceVariableByText(array('faks' => $dataProdi->faks));		$docx->replaceVariableByText(array('homepage' => $dataProdi->homepage));		/*IDENTITAS PRODI - END*/		/*STANDAR 1 - BEGIN*/		$docx->replaceVariableByText(array('mekanisme' => $dataProdi->mekanisme));		$docx->replaceVariableByText(array('visi' => $dataProdi->visi));		$docx->replaceVariableByText(array('misi' => $dataProdi->misi));		$docx->replaceVariableByText(array('tujuan' => $dataProdi->tujuan));		$docx->replaceVariableByText(array('sasaran' => $dataProdi->sasaran));		$docx->replaceVariableByText(array('sosialisasi' => $dataProdi->sosialisasi));		/*STANDAR 1 - END*/		/*STANDAR 2 - BEGIN*/		$docx->replaceVariableByText(array('tatapamong' => $dataProdi->tatapamong));		$docx->replaceVariableByText(array('kepemimpinan' => $dataProdi->kepemimpinan));		$docx->replaceVariableByText(array('pengelolaan' => $dataProdi->pengelolaan));		$docx->replaceVariableByText(array('penjaminanmutu' => $dataProdi->penjaminanmutu));		/*STANDAR 2 - END*/		/*STANDAR 3 - BEGIN*/		/*STANDAR 3 - END*/		/*STANDAR 4 - BEGIN*/		$tableItems = array();		$dosenTetapSesuaiBidangProdi = $this->Dosen_model->dosenProdiWithStatus($id_prodi, 1);		$dosenTetapTidakSesuaiBidangProdi = $this->Dosen_model->dosenProdiWithStatus($id_prodi, 2);		$dosenTidakTetap = $this->Dosen_model->dosenProdiWithStatus($id_prodi, 3);		$i = 0;				foreach($dosenTetapSesuaiBidangProdi -> result_array() as $dosen) {			$i = $i + 1;	        $tableItems[] = array(	            'iv-iii-i-1'  => $i, 	            'iv-iii-i-2'  => $dosen['nama'],	            'iv-iii-i-3'  => $dosen['nidn'],	            'iv-iii-i-4'  => date_format(date_create($dosen['tanggal_lahir']), 'j M Y'),	            'iv-iii-i-5'  => $dosen['jabatan_akademik'],	        );		}		$docx->replaceTableVariable($tableItems);		$i = 0;		foreach($dosenTetapTidakSesuaiBidangProdi -> result_array() as $dosen) {			$i = $i + 1;		    $nama = $dosen['nama'];	        $tableItems[] = array(	            'iv-iii-ii-1'  => $i, 	            'iv-iii-ii-2'  => $dosen['nama'],	            'iv-iii-ii-3'  => $dosen['nidn'],	            'iv-iii-ii-4'  => date_format(date_create($dosen['tanggal_lahir']), 'j M Y'),	            'iv-iii-ii-5'  => $dosen['jabatan_akademik'],	        );		}		$i = 0;		foreach($dosenTidakTetap -> result_array() as $dosen) {			$i = $i + 1;		    $nama = $dosen['nama'];	        $tableItems[] = array(	            'iv-iv-i-1'  => $i, 	            'iv-iv-i-2'  => $dosen['nama'],	            'iv-iv-i-3'  => $dosen['nidn'],	            'iv-iv-i-4'  => date_format(date_create($dosen['tanggal_lahir']), 'j M Y'),	            'iv-iv-i-5'  => $dosen['jabatan_akademik'],	        );		}		/*STANDAR 4 - END*/		/*STANDAR 5 - BEGIN*/		$tableMatkul = array();		$kode_kurikulum = $this->Kurikulum_model->kurikulum_berlaku_prodi($id_prodi);		$matkulArray = $this->Matkul_model->matkulByKurikulum($kode_kurikulum, "Wajib");		foreach($matkulArray -> result_array() as $matkul) {			if ($matkul['is_bobot_20'] == "Ya") {				$isbobot = "√";			} else {				$isbobot = "-";			}			if ($matkul['deskripsi'] == "") {				$isbobot = "-";			} else {				$isbobot = "√";			}			if ($matkul['silabus'] == "") {				$isbobot = "-";			} else {				$isbobot = "√";			}			if ($matkul['sap'] == "") {				$isbobot = "-";			} else {				$isbobot = "√";			}				        $tableMatkul[] = array(	            'v-i-ii-ii-1'  => $matkul['semester'], 	            'v-i-ii-ii-2'  => $matkul['kode'], 	            'v-i-ii-ii-3'  => $matkul['mata_kuliah'], 	            'v-i-ii-ii-4'  => $matkul['sks'], 	            'v-i-ii-ii-5'  => $matkul['sks_inti'], 	            'v-i-ii-ii-6'  => $matkul['sks_institusional'], 	            'v-i-ii-ii-7'  => $isbobot, 	            'v-i-ii-ii-8'  => $isdesc, 	            'v-i-ii-ii-9'  => $issilabus, 	            'v-i-ii-ii-10'  => $issap, 	            'v-i-ii-ii-11'  => $dataProdi->prodi, 	        );		}		$docx->replaceTableVariable($tableMatkul);		/*STANDAR 5 - END*/		/*STANDAR 6 - BEGIN*/		/*STANDAR 6 - END*/				/*STANDAR 7 - BEGIN*/		/*PENELITIAN - BEGIN	*/		for ($sumberdana=1; $sumberdana <= 5; $sumberdana++) { 			$p1 = $this->Penelitian_model->jumlahPenelitianProdiPerTahunBySumber($id_prodi, $tsmin2, $sumberdana);			$p2 = array($ts => 0, $tsmin1 => 0, $tsmin2 => 0);						foreach ($p1 as $p) {				$p2[$p->tahun] = $p->jumlah;			}			$docx->replaceVariableByText(array('vii_i_i_2_'.$sumberdana => $p2[$tsmin2]));			$docx->replaceVariableByText(array('vii_i_i_3_'.$sumberdana => $p2[$tsmin1]));			$docx->replaceVariableByText(array('vii_i_i_4_'.$sumberdana => $p2[$ts]));		}		/*PENELITIAN - END		*/		/*PUBLIKASI - BEGIN*/		$p1 = $this->Publikasi_model->publikasiProdiSejakTahun($id_prodi, $tsmin2);		if (count($p1) > 0) {			$i = 0;			foreach($p1 as $publikasi) {				$i = $i + 1;				switch ($publikasi->tingkat) {					case 1:						$islokal = "√";						$isnasional = "";						$isinternasional = "";						break;										case 2:						$islokal = "";						$isnasional = "√";						$isinternasional = "";						break;										case 3:						$islokal = "";						$isnasional = "";						$isinternasional = "√";						break;										default:						$islokal = "";						$isnasional = "";						$isinternasional = "";						break;				}		        $tablePublikasi[] = array(		            'vii_i_iii_1'  => $i, 		            'vii_i_iii_2'  => $publikasi->judul, 		            'vii_i_iii_3'  => $publikasi->penulis, 		            'vii_i_iii_4'  => $publikasi->tempat, 		            'vii_i_iii_5'  => $publikasi->tahun, 		            'vii_i_iii_6'  => $islokal, 		            'vii_i_iii_7'  => $isnasional, 		            'vii_i_iii_8'  => $isinternasional, 		        );			}			$docx->replaceTableVariable($tablePublikasi);		} else {			$docx->replaceVariableByText(array('vii_i_iii_1' => '-'));			$docx->replaceVariableByText(array('vii_i_iii_2' => '-'));			$docx->replaceVariableByText(array('vii_i_iii_3' => '-'));			$docx->replaceVariableByText(array('vii_i_iii_4' => '-'));			$docx->replaceVariableByText(array('vii_i_iii_5' => '-'));			$docx->replaceVariableByText(array('vii_i_iii_6' => '-'));			$docx->replaceVariableByText(array('vii_i_iii_7' => '-'));			$docx->replaceVariableByText(array('vii_i_iii_8' => '-'));		}		/*PUBLIKASI - END*/		/*PENGABDIAN MASYARAKAENGABDIAN TASYARAKAT - BEGIN		*/		for ($sumberdana=1; $sumberdana <= 5; $sumberdana++) { 			$p1 = $this->Pm_model->jumlahPmProdiPerTahunBySumber($id_prodi, $tsmin2, $sumberdana);			$p2 = array($ts => 0, $tsmin1 => 0, $tsmin2 => 0);						foreach ($p1 as $p) {				$p2[$p->tahun] = $p->jumlah;			}			$docx->replaceVariableByText(array('vii_ii_i_2_'.$sumberdana => $p2[$tsmin2]));			$docx->replaceVariableByText(array('vii_ii_i_3_'.$sumberdana => $p2[$tsmin1]));			$docx->replaceVariableByText(array('vii_ii_i_4_'.$sumberdana => $p2[$ts]));		}		/*PENGABDIAN MASYARAKAT - END	*/		/*STANDAR 7 - END*/		$reports = 'Borang Prodi '.$dataProdi->prodi.' Tahun '.$ts;		/* echo($reports);*/		$docx->clearBlocks();		$docx->createDocx($this->report.'/'.$reports);		$this->forceDownloadFile($this->report.'/'.$reports);		$docx->createDocxAndDownload($reports);	}}